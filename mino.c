#include "mino.h"
#include "utils.h"

typedef struct POINT
{
    int x, y;
} POINT;

static unsigned char colours[PIECE_MAX][3] = {
    {0xEF, 0xE7, 0x10}, // O
    {0xc2, 0x2d, 0xd2}, // T
    {0x1e, 0xcb, 0xe1}, // I
    {0x16, 0x0b, 0xf4}, // J
    {0xff, 0xc2, 0x00}, // L
    {0x41, 0xff, 0x00}, // S
    {0xe7, 0x18, 0x23}, // Z
};

static POINT rotations[PIECE_MAX][4][4] = {
    {
        // O
        {
            //  ##
            //  ##
            //
            {.x = 1, .y = 0},
            {.x = 2, .y = 0},
            {.x = 1, .y = 1},
            {.x = 2, .y = 1},
        },
        {
            //  ##
            //  ##
            //
            {.x = 1, .y = 0},
            {.x = 2, .y = 0},
            {.x = 1, .y = 1},
            {.x = 2, .y = 1},
        },
        {
            //  ##
            //  ##
            //
            {.x = 1, .y = 0},
            {.x = 2, .y = 0},
            {.x = 1, .y = 1},
            {.x = 2, .y = 1},
        },
        {
            //  ##
            //  ##
            //
            {.x = 1, .y = 0},
            {.x = 2, .y = 0},
            {.x = 1, .y = 1},
            {.x = 2, .y = 1},
        },
    },
    {
        // T
        {
            //  #
            // ###
            {.x = 1, .y = 0},
            {.x = 0, .y = 1},
            {.x = 1, .y = 1},
            {.x = 2, .y = 1},
        },
        {
            //  #
            //  ##
            //  #
            {.x = 1, .y = 0},
            {.x = 1, .y = 1},
            {.x = 1, .y = 2},
            {.x = 2, .y = 1},
        },
        {
            //
            // ###
            //  #
            {.x = 1, .y = 2},
            {.x = 0, .y = 1},
            {.x = 1, .y = 1},
            {.x = 2, .y = 1},
        },
        {
            //  #
            // ##
            //  #
            {.x = 1, .y = 0},
            {.x = 1, .y = 1},
            {.x = 1, .y = 2},
            {.x = 0, .y = 1},
        },
    },
    {
        // I
        {
            //
            // ####
            //
            //
            {.x = 0, .y = 1},
            {.x = 1, .y = 1},
            {.x = 2, .y = 1},
            {.x = 3, .y = 1},
        },
        {
            //   #
            //   #
            //   #
            //   #
            {.x = 2, .y = 0},
            {.x = 2, .y = 1},
            {.x = 2, .y = 2},
            {.x = 2, .y = 3},
        },
        {
            //
            //
            // ####
            //
            {.x = 0, .y = 2},
            {.x = 1, .y = 2},
            {.x = 2, .y = 2},
            {.x = 3, .y = 2},
        },
        {
            //  #
            //  #
            //  #
            //  #
            {.x = 1, .y = 0},
            {.x = 1, .y = 1},
            {.x = 1, .y = 2},
            {.x = 1, .y = 3},
        },
    },
    {
        // J
        {
            // #
            // ###
            //
            {.x = 0, .y = 0},
            {.x = 0, .y = 1},
            {.x = 1, .y = 1},
            {.x = 2, .y = 1},
        },
        {
            //  ##
            //  #
            //  #
            {.x = 1, .y = 0},
            {.x = 1, .y = 1},
            {.x = 1, .y = 2},
            {.x = 2, .y = 0},
        },
        {
            //
            // ###
            //   #
            {.x = 2, .y = 2},
            {.x = 0, .y = 1},
            {.x = 1, .y = 1},
            {.x = 2, .y = 1},
        },
        {
            //  #
            //  #
            // ##
            {.x = 1, .y = 0},
            {.x = 1, .y = 1},
            {.x = 1, .y = 2},
            {.x = 0, .y = 2},
        },
    },
    {
        // L
        {
            //   #
            // ###
            //
            {.x = 2, .y = 0},
            {.x = 0, .y = 1},
            {.x = 1, .y = 1},
            {.x = 2, .y = 1},
        },
        {
            //  #
            //  #
            //  ##
            {.x = 1, .y = 0},
            {.x = 1, .y = 1},
            {.x = 1, .y = 2},
            {.x = 2, .y = 2},
        },
        {
            //
            // ###
            // #
            {.x = 0, .y = 2},
            {.x = 0, .y = 1},
            {.x = 1, .y = 1},
            {.x = 2, .y = 1},
        },
        {
            // ##
            //  #
            //  #
            {.x = 1, .y = 0},
            {.x = 1, .y = 1},
            {.x = 1, .y = 2},
            {.x = 0, .y = 0},
        },
    },
    {
        // S
        {
            //  ##
            // ##
            //
            {.x = 0, .y = 1},
            {.x = 1, .y = 1},
            {.x = 1, .y = 0},
            {.x = 2, .y = 0},
        },
        {
            //  #
            //  ##
            //   #
            {.x = 1, .y = 0},
            {.x = 1, .y = 1},
            {.x = 2, .y = 1},
            {.x = 2, .y = 2},
        },
        {
            //
            //  ##
            // ##
            {.x = 0, .y = 2},
            {.x = 1, .y = 2},
            {.x = 1, .y = 1},
            {.x = 2, .y = 1},
        },
        {
            // #
            // ##
            //  #
            {.x = 0, .y = 0},
            {.x = 0, .y = 1},
            {.x = 1, .y = 1},
            {.x = 1, .y = 2},
        },
    },
    {
        // Z
        {
            // ##
            //  ##
            //
            {.x = 0, .y = 0},
            {.x = 1, .y = 0},
            {.x = 1, .y = 1},
            {.x = 2, .y = 1},
        },
        {
            //   #
            //  ##
            //  #
            {.x = 2, .y = 0},
            {.x = 2, .y = 1},
            {.x = 1, .y = 1},
            {.x = 1, .y = 2},
        },
        {
            //
            // ##
            //  ##
            {.x = 0, .y = 1},
            {.x = 1, .y = 1},
            {.x = 1, .y = 2},
            {.x = 2, .y = 2},
        },
        {
            //  #
            // ##
            // #
            {.x = 1, .y = 0},
            {.x = 1, .y = 1},
            {.x = 0, .y = 1},
            {.x = 0, .y = 2},
        },
    },
};


ALLEGRO_COLOR mino_get_default_colour(PIECE piece)
{
    ASSERT_PIECE(piece);

    unsigned char r = colours[piece][0];
    unsigned char g = colours[piece][1];
    unsigned char b = colours[piece][2];

    return al_map_rgb(r, g, b);
}

void mino_unmap_xy_offsets(PIECE piece, int rotation, int idx, int* x, int* y)
{
    ASSERT_PIECE(piece);
    ASSERT_ROTATION(rotation);
    ASSERT_RANGE(idx, 0, 4, "mino offset");

    * x = rotations[piece][rotation][idx].x;
    * y = rotations[piece][rotation][idx].y;
}